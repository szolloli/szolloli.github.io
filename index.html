<!DOCTYPE html>
<html lang="en">

<head>
        <style type="text/css">
            body, html
            {
                margin: 0; padding: 0; height: 100%; overflow: hidden;
            }

            #content
            {
                position:absolute; left: 0; right: 0; bottom: 0; top: 0px; 
            }
		
		      a {
        font-size:16px;
        line-height:16px;
        padding:10px 30px;
        background-color:#2569bb;
        color:#ffffff;
        text-decoration:none;
        border-radius:7px;
        font-weight:normal;
        font-family:Arial;
      }
      p {
        font-family: Arial;
      }
      .center {
        text-align: center;
        position: absolute;
        top: 50%;
      }
        </style>
</head>

<body>
            <div id="placeholder" class="row justify-content-center">
                <div class="col" style="max-width: 100%;" id="rapyd-checkout"></div>
            </div>

    <!-- code to display the iframe -->
    <script src="https://checkouttoolkit.rapyd.net"></script>
    <script>
        window.onload = function () { 



            let checkout = new RapydCheckoutToolkit({
                pay_button_text: "Pay Now",
                pay_button_color: "#4BB4D2",
                id: window.location.search.substring(1), // your checkout page id goes here
                style: {
                    submit: {
                        base: {
                            color: "white"
                        }
                    }
                }
            });
            checkout.displayCheckout();
        }
        window.addEventListener('onCheckoutPaymentSuccess', function (event) {
            console.log(event.detail);
            
            console.log(event.detail.status);
            
            if (event.detail.status === 'CLO') {
		
                var myDiv = document.createElement('div');
                myDiv.className = 'center';
        
                var myP = document.createElement('p');
                const node = document.createTextNode("Transaction successful");
                myP.appendChild(node);
        
                var myA = document.createElement('a');
                myA.textContent = 'Continue in app';
                myA.href = 'symplifi://';
        
                myDiv.appendChild(myP);
                myDiv.appendChild(myA);
		    
		var elem = document.getElementById('placeholder');
                elem.replaceWith(myDiv);
            }
            if (event.detail.status === 'ACT') {
		console.log(event.detail);


               var ifrm = document.createElement('iframe');
                ifrm.setAttribute('id', 'ifrm'); // assign an id

                
                const elem = document.getElementById('placeholder');
                elem.replaceWith(ifrm);

                // to place before another page element
//                 var el = document.getElementById('marker');
//                 el.parentNode.insertBefore(ifrm, el);

                // assign url
                ifrm.setAttribute('src', event.detail.redirect_url);
		ifrm.setAttribute('frameborder', 0);
ifrm.setAttribute('width', '100%');
ifrm.setAttribute('height', '100%');

            }
        });
        window.addEventListener('onCheckoutFailure', function (event) {
            console.log(event.detail.error);
        });
        window.addEventListener('onCheckoutPaymentFailure', (event)=> {
            console.log(event.detail.error);
        })


        // display information to the user
        function feedback(event){
            if (event.detail.error){
                document.getElementById('title').textContent = "Whoops!";
                document.getElementById('message').innerHTML = "We cannot process your payment:<br/>" + 
                    event.detail.error;
                document.getElementById('image').src = "img/no-bike.svg";
                document.getElementById('action').textContent = "Try again";
            }
            else {
                document.getElementById('title').textContent = "Success!";
                document.getElementById('message').innerHTML = "Thank you! Your product is on its way!" + 
                    "<br>" +
                    "Order: " + event.detail.metadata.sales_order;
                document.getElementById('image').src = "img/logo.svg";
                document.getElementById('action').textContent = "Home";
            }

            document.getElementById('action').href = "bike.html";
            document.getElementById('feedback').style.display = "block";
        }
    </script>

</body>
</html>
